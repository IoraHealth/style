<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Iora Health's Ruby coding style guidelines" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Iora Health: Ruby code style guide</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">Iora Health</h1>
          <h2 id="project_tagline">Ruby coding guidelines</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
      <h3><a href="#welcome">Welcome!</a></h3>
        <p>Greetings! I hope you have gathered here for some ruby coding
        guidelines as there will be no pictures of cats on this particular
        webpage.</p>
        <p>These sets of guidelines are developed based upon our tastes at Iora
        and are used to drive our internal development practices.  If they 
        suit your needs as well then feel free to make them your own!</p>
        <p>We have borrowed heavily from <a href="https://github.com/bbatsov/ruby-style-guide">https://github.com/bbatsov/ruby-style-guide</a>
        as well as <a href="https://github.com/styleguide/ruby/">https://github.com/styleguide/ruby/</a>
        and <a href="https://github.com/copycopter/style-guide">https://github.com/copycopter/style-guide</a>
        in the creation of our own set of guidelines.<p>

      <h3><a href="#spacing">Layout and Spacing</a></h3>
        <ul>
          <li>
            <p>Try to keep lines fewer than 80 characters.</p>
          </li>
          <li>
            <p>Never, ever leave trailing whitespace.  Let a machine help you
               in this endeavor by setting your text editor to be obnoxious when
               you leave trailing whitespace.</p>
          </li>
          <li>
            <p>Only use spaces.  Never use tabs.  We will publicly shame you if
            your text editor is somehow set to use tabs as this is a problem a
            machine can solve for you.</p>
            <p>Here are people who have abused the tab policy thus far:</p>
            <ul>
              <li>Matthew 'Conksy' Sisto</li>
            </ul>
          </li>
          <li>
            <p>Use two spaces per indentation level.</p>
          <div class="highlight"><pre><code class="ruby"><span class="c1"># good</span>
<span class="k">def</span> <span class="nf">some_method</span>
  <span class="n">do_something</span>
<span class="k">end</span>

<span class="c1"># bad - four spaces</span>
<span class="k">def</span> <span class="nf">some_method</span>
    <span class="n">do_something</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Do not use spaces after <code>(</code>, <code>[</code> or before
            <code>]</code>, <code>)</code>.</p>
            <div class="highlight"><pre><code class="ruby"><span class="n">pickles</span><span class="p">(</span><span class="n">gherkin</span><span class="p">)</span><span class="o">.</span><span class="n">eat</span>
<span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">length</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Do use spaces after <code>{</code> and before <code>}</code>.</p>
            <div class="highlight"><pre><code class="ruby"><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">12</span><span class="o">].</span><span class="n">map</span> <span class="k">do</span> <span class="p">{</span> <span class="o">|</span><span class="n">hour</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">hour</span><span class="si">}</span><span class="s2"> O&#39;clock ROCK!!!!&quot;</span> <span class="p">}</span>
</code></pre>
</div>


        </ul>
      <h3><a href="#methods">Methods</a></h3>
        <ul>
          <li>
            <p>Parathensis are only used on <code>def</code> statements that have
            parameters.</p>
            <div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">party_rock</span>
  <span class="n">one_two_shuffle</span> <span class="n">left_foot</span><span class="p">,</span> <span class="n">right_foot</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">one_two_shuffle</span><span class="p">(</span><span class="n">lefty</span><span class="p">,</span> <span class="n">righty</span><span class="p">)</span>
  <span class="n">lefty</span><span class="o">.</span><span class="n">shake_it</span> <span class="o">&amp;&amp;</span> <span class="n">righty</span><span class="o">.</span><span class="n">shake_it</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Break up method definitions by putting blank lines between them.
               Nobody likes a person that fails to break up paragaphs into separate
               lines.  So don't be that guy.
            </p>
            <div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">four_score</span>
  <span class="n">talk_forever</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">seven_years_ago</span>
  <span class="n">do_not_get_shot</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Break up code inside methods into logical paragraphs.  Some
               great opportunities for breaking up methods include:</p>
            <ul>
              <li>Following a block of variable assignment</li>
              <li>Following a multi-line block</li>
              <li>Before a return statement</li>
            </ul>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># vertical space following variable assignment</span>
<span class="k">def</span> <span class="nf">allowed_in_restaurant?</span>
  <span class="n">shirt</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">pants</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="n">shoes</span> <span class="o">=</span> <span class="kp">true</span>

  <span class="n">shirt</span> <span class="o">&amp;&amp;</span> <span class="n">pants</span> <span class="o">&amp;&amp;</span> <span class="n">shoes</span>
<span class="k">end</span>

<span class="c1"># vertical space following multi-line block</span>
<span class="k">def</span> <span class="nf">rock</span>
  <span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">12</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">hour</span><span class="o">|</span>
    <span class="n">ready_to_rock?</span>
  <span class="k">end</span>

  <span class="n">rock_around_the_clock_tonight</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Avoid using <code>return</code> unless you absolutely have to.</p>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># superfluous return statement and method in general</span>
<span class="k">def</span> <span class="nf">sexy_and_i_know_it</span>
  <span class="k">return</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># now only a superfluous method</span>
<span class="k">def</span> <span class="nf">sexy_and_i_know_it</span>
  <span class="kp">true</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Put a space around the default value operator <code>=</code> on
            method definitions.  You put spaces around it everywhere else so it
            only makes sense to do so here!</p>
            <div class="highlight"><pre><code class="ruby">  <span class="k">def</span> <span class="nf">mix_old_fashioned</span><span class="p">(</span><span class="n">booze</span> <span class="o">=</span> <span class="ss">:rye</span><span class="p">,</span> <span class="n">fruit</span> <span class="o">=</span> <span class="ss">:orange</span><span class="p">)</span>
    <span class="n">shake_it_like_a_polaroid</span>
  <span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>While it is possible to place a space between the method
            definition and the parenthesis; I question your sanity for doing
            so.</p>
            <div class="highlight"><pre><code class="ruby"><span class="n">hiring_mistake</span> <span class="p">(</span><span class="kp">true</span><span class="p">)</span> <span class="c1"># This is self documenting code at its best</span>
</code></pre>
</div>


          </li>
        </ul>
      <h3><a href="#language-trivia">Language Trivia</a></h3>
        <p>Like any programming language, Ruby has both good and bad parts.  It
        would not be a coding guideline document if we didn't go over the parts
        of the language we should just flat out avoid in our day-to-day work.</p>
        <ul>
          <li>
            <p>The <code>for</code> loop should be avoided at all costs. 
            Internally it is implemented as an <code>each</code> loop but without
            properly scoping the block variable.</p>
            <div class="highlight"><pre><code class="ruby"><span class="k">for</span> <span class="n">num</span> <span class="k">in</span> <span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">12</span><span class="o">]</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span>
<span class="k">end</span>

<span class="c1"># This is just plain wrong.</span>
<span class="nb">puts</span> <span class="n">num</span> <span class="c1"># =&gt; 12</span>

<span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">12</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">num</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="p">}</span>

<span class="nb">puts</span> <span class="n">num</span> <span class="c1"># =&gt; NoMethodError</span>
</code></pre>
</div>


          </li>
          <li>
            <p>The use of <code>then</code> is likely to happen when you think
            you are writing coffescript code and not ruby.  We write a heck of
            a lot of coffescript so I do not die on the inside when you use it.</p>
            <p>There are are two failed casses when using <code>then</code>:</p>
            <ul>
              <li>On ending a multiline <code>if</code> statement</li>
              <div class="highlight"><pre><code class="ruby"><span class="k">if</span> <span class="n">party_time?</span> <span class="k">then</span>
  <span class="c1"># IT ISNT PARTY TIME BECAUSE I HAVE ENDED YOU</span>
<span class="k">end</span>
</code></pre>
</div>


              <li>As a verbose ternary operator</li>
              <div class="highlight"><pre><code class="ruby"><span class="k">if</span> <span class="n">coffeescript?</span> <span class="k">then</span> <span class="sr">/*it isn&#39;t jerk*/</span> <span class="k">else</span> <span class="nb">puts</span> <span class="s2">&quot;ruh-roh&quot;</span> <span class="k">end</span>
</code></pre>
</div>


            </ul>
            <p>In the former case you've written an unecessary statement.  In
            the latter case you are wasting all of our time because people that
            made coffeescript were too lazy to write a proper ternary operator.</p>
          </li>
          <li>
            <p><code>and</code> and <code>or</code> are not equivalent to
            <code>&&</code> and <code>||</code>.  They take a much lower precedence
            and chances are that your code will not do what you'd like it to do. 
            It is best to avoid <code>and</code> and <code>or</code> altogether 
            despite the fact that your code may appear more readable.</p>
          </li>
          <li>
            <p>Use the nilguard (<code>||=</code>) freely to memoize variables.
            There are exceptions to when the nilguard will bite you in the butt:</p>
            <ul>
              <li>When <code>nil</code> is a valid value (duhhhhhhhh)</li>
              <li>When <code>false</code> is a valid value</li>
              <div class="highlight"><pre><code class="ruby"><span class="c1"># Future arrest pending</span>
<span class="n">pants_on</span> <span class="o">=</span> <span class="kp">false</span>

<span class="k">def</span> <span class="nf">can_go_outside?</span><span class="p">(</span><span class="n">pants_status</span><span class="p">)</span>
  <span class="n">pants_status</span> <span class="o">||=</span> <span class="kp">true</span>

  <span class="n">pants_status</span>
<span class="k">end</span>

<span class="n">can_go_outside?</span> <span class="n">pants_on</span> <span class="c1"># =&gt; true</span>

<span class="c1"># Safety from prosecution</span>
<span class="k">def</span> <span class="nf">can_go_outside?</span><span class="p">(</span><span class="n">pants_status</span><span class="p">)</span>
  <span class="n">pants_status</span> <span class="o">=</span> <span class="kp">true</span> <span class="k">if</span> <span class="n">pants_status</span><span class="o">.</span><span class="n">nil?</span>

  <span class="n">pants_status</span>
<span class="k">end</span>

<span class="n">can_go_outside?</span> <span class="n">pants_on</span> <span class="c1"># =&gt; false</span>
</code></pre>
</div>


            </ul>
          </li>
          <li>
          <p>Use <code>_</code> for unused block variables.</p>
          <div class="highlight"><pre><code class="ruby"><span class="n">result</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">_</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
</code></pre>
</div>


          </li>
        </ul>
      <h3><a href="#conditionals">Conditionals</a></h3>
        <ul>
          <li>
            <p>The ternary operator hides multiple execution paths in one
            handy little line.  It should be avoided except when the conditions
            are trivial.  Consider using a multiline <code>if</code>/<code>else</code>
            statement instead.</p>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># Too much going on</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">4</span> <span class="p">:</span> <span class="n">number</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Just enough going on</span>
<span class="n">result</span> <span class="o">=</span> <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="n">number</span> <span class="o">%</span> <span class="mi">4</span>
<span class="k">else</span>
  <span class="n">number</span> <span class="o">/</span> <span class="mi">4</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Use the modifier <code>if</code>/<code>unless</code> for single
            statements.</p>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># Not the greatest</span>
<span class="k">def</span> <span class="nf">send_tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">140</span>
    <span class="no">TwitterStream</span><span class="o">.</span><span class="n">enqueue</span> <span class="n">message</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Better</span>
<span class="k">def</span> <span class="nf">send_tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="no">TwitterStream</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">140</span>
<span class="k">end</span>

<span class="c1"># Bettererer</span>
<span class="k">def</span> <span class="nf">send_tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="no">TwitterStrem</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">usable_on_twitter?</span>
<span class="k">end</span>
</code></pre>
</div>


          <li>
            <p>Indent <code>when</code> at the same level as <code>case</code>.
            The <code>else</code> statement belongs on the same level of
            indentation as <code>when</code> and <code>case</code>.</p>
            <div class="highlight"><pre><code class="ruby"><span class="k">case</span>
<span class="k">when</span> <span class="n">song</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Misty&#39;</span>
  <span class="nb">puts</span> <span class="s1">&#39;Not again!&#39;</span>
<span class="k">when</span> <span class="n">song</span><span class="o">.</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">120</span>
  <span class="nb">puts</span> <span class="s1">&#39;Too long!&#39;</span>
<span class="k">when</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">21</span>
  <span class="nb">puts</span> <span class="s2">&quot;It&#39;s too late&quot;</span>
<span class="k">else</span>
  <span class="n">song</span><span class="o">.</span><span class="n">play</span>
<span class="k">end</span>

<span class="n">kind</span> <span class="o">=</span> <span class="k">case</span> <span class="n">year</span>
       <span class="k">when</span> <span class="mi">1850</span><span class="o">.</span><span class="n">.</span><span class="mi">1889</span> <span class="k">then</span> <span class="s1">&#39;Blues&#39;</span>
       <span class="k">when</span> <span class="mi">1890</span><span class="o">.</span><span class="n">.</span><span class="mi">1909</span> <span class="k">then</span> <span class="s1">&#39;Ragtime&#39;</span>
       <span class="k">when</span> <span class="mi">1910</span><span class="o">.</span><span class="n">.</span><span class="mi">1929</span> <span class="k">then</span> <span class="s1">&#39;New Orleans Jazz&#39;</span>
       <span class="k">when</span> <span class="mi">1930</span><span class="o">.</span><span class="n">.</span><span class="mi">1939</span> <span class="k">then</span> <span class="s1">&#39;Swing&#39;</span>
       <span class="k">when</span> <span class="mi">1940</span><span class="o">.</span><span class="n">.</span><span class="mi">1950</span> <span class="k">then</span> <span class="s1">&#39;Bebop&#39;</span>
       <span class="k">else</span> <span class="s1">&#39;Jazz&#39;</span>
       <span class="k">end</span>
</code></pre>
</div>


          </li>
          <li>
            <p>Pairing <code>unless</code> with an <code>else</code> is bad
            news bears.  It's possible to swap the statement into an <code>if</code>
            /<code>else</code> by reversing the order of the conditionals and it
            prevents our minds from melting.</p>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># The priorities here seem to be all wrong</span>
<span class="k">unless</span> <span class="n">party_time?</span>
  <span class="n">listen_to_jazz_music</span>
<span class="k">else</span>
  <span class="n">rock_out_with_reckless_abandon</span>
<span class="k">end</span>

<span class="c1"># Company culture upheld!!!</span>
<span class="k">if</span> <span class="n">party_time?</span>
  <span class="n">rock_out_with_reckless_abandon</span>
<span class="k">else</span>
  <span class="n">listen_to_jazz_music</span>
<span class="k">end</span>
</code></pre>
</div>


            <p><code>unless</code> is used to clarify exceptional cases.  When
            there is both a positive and negative case it loses all clarity. As
            a company we want to hear the good news before the bad news in our 
            conditional statements.</p>
          </li>
          <li>
            <p>It is rather possible to assign values in if statements.  Where
            it starts going downhill though is that <code>=</code> is one
            keystroke away from <code>==</code> and the intent of the code is
            not easily gleaned without a deeper code dive.</p>

            <p>In order to alleviate this burden upon the future reader of your
            code it is best to encapsulate assignment within an if statement
            with parenthesis.</p>
            <div class="highlight"><pre><code class="ruby"><span class="c1"># Checking equality</span>
<span class="k">if</span> <span class="n">pants_off_dance_off</span> <span class="o">==</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="n">take_pants_off</span>
<span class="k">end</span>

<span class="c1"># Assigning a value</span>
<span class="k">if</span> <span class="p">(</span><span class="n">pants_off_dance_off</span> <span class="o">=</span> <span class="no">Party</span><span class="o">.</span><span class="n">party_o_clock</span><span class="p">)</span>
  <span class="no">PartyQueue</span><span class="o">.</span><span class="n">enqueue</span> <span class="n">pants_off_dance_off</span>
<span class="k">end</span>
</code></pre>
</div>


          </li>
        </ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
